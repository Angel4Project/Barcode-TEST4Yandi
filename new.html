<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>חוויית AR - פירוק ברקוד והופעת דמות</title>
    <!-- טעינת A-Frame (חינמי וקוד פתוח) -->
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <!-- טעינת AR.js (גרסה לשילוב עם A-Frame) -->
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
    </style>
  </head>
  <body>
    <!-- סצנה עם AR – משתמשת במצלמה (webcam) -->
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
      <!-- Marker – כאן לדוגמה השתמשנו בסימן 'hiro'. ניתן להחליף לסימן מותאם (למשל, סימן שמכיל את קוד ה-QR שלך) -->
      <a-marker preset="hiro">
        <!-- ישות המציגה את "הברקוד" – ניתן לשנות לצורה או טקסטורה לפי הצורך -->
        <a-entity id="barcode" geometry="primitive: plane; width: 1; height: 1"
                  material="color: #ffffff; opacity: 1" position="0 0 0">
        </a-entity>

        <!-- ישות הדמות – מוצגת בהמשך (מוסתרת בתחילה) -->
        <a-entity id="character" position="0 0 0" visible="false">
          <!-- לדוגמה, קופסה תלת-ממדית – אפשר להחליף במודל glTF (קוד פתוח) -->
          <a-box color="#4CC3D9" depth="0.5" height="1" width="0.5"></a-box>
        </a-entity>

        <!-- ישות הסרטון – מופיעה לאחר הדמות, גם היא מוסתרת בתחילה -->
        <a-entity id="promoVideo" geometry="primitive: plane; width: 1.2; height: 0.8"
                  position="0 0.5 0" visible="false">
          <a-video src="#videoAsset" width="1.2" height="0.8"></a-video>
        </a-entity>
      </a-marker>

      <!-- מצלמה -->
      <a-entity camera></a-entity>
    </a-scene>

    <!-- הגדרת משאב וידאו – יש להחליף את 'your-video-file.mp4' בכתובת הקובץ שלך -->
    <video id="videoAsset" src="your-video-file.mp4" crossorigin="anonymous"
           playsinline webkit-playsinline muted></video>

    <script>
      // מתן לוגיקה לאירועי זיהוי ואיבוד הסימן (markerFound/markerLost)
      document.addEventListener("DOMContentLoaded", function () {
        const barcode = document.querySelector('#barcode');
        const character = document.querySelector('#character');
        const promoVideo = document.querySelector('#promoVideo');
        
        // כאשר הסימן מזוהה
        barcode.addEventListener('markerFound', function() {
          console.log('סימן התגלה');
          // אפקט פירוק – מצמצם בהדרגה את השקיפות של הישות "barcode"
          barcode.setAttribute('animation__fade', {
            property: 'material.opacity',
            to: 0,
            dur: 2000,
            easing: 'linear'
          });
          // לאחר סיום אפקט הפירוק, הופעת הדמות
          setTimeout(function(){
            character.setAttribute('visible', 'true');
            character.setAttribute('scale', '0 0 0');
            character.setAttribute('animation__scale', {
              property: 'scale',
              to: '1 1 1',
              dur: 1500,
              easing: 'easeOutElastic'
            });
          }, 2100);
          // לאחר הופעת הדמות, הופעת הסרטון והפעלתו
          setTimeout(function(){
            promoVideo.setAttribute('visible', 'true');
            const videoEl = document.querySelector('#videoAsset');
            videoEl.play();
          }, 4000);
        });
        
        // בעת איבוד הסימן – איפוס המצב
        barcode.addEventListener('markerLost', function() {
          console.log('סימן אבד');
          barcode.setAttribute('material', 'opacity', 1);
          character.setAttribute('visible', 'false');
          promoVideo.setAttribute('visible', 'false');
          const videoEl = document.querySelector('#videoAsset');
          videoEl.pause();
        });
      });
    </script>
  </body>
</html>
